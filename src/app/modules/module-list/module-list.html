<section class="p-6 max-w-3xl mx-auto">
  <h2 class="text-2xl font-bold mb-4 text-gray-800 text-center">
    Modules for {{ courseTitle || ('Course ' + courseId) }}
  </h2>

  <!-- Spinner -->
  @if (loading) {
    <div class="text-blue-600 font-medium">Loading modules...</div>
  }

  <!-- Error -->
  @if (errorMessage) {
    <div class="bg-red-100 text-red-700 p-3 rounded-md mb-4">
      {{ errorMessage }}
    </div>
  }

  <!-- Modules -->
  @if (!loading && !errorMessage) {
    @let modules = modules$ | async;
    @if (modules && modules.length > 0) {
      <ul class="space-y-2 mb-4">
        @for (mod of modules; track mod.id) {
          <li
            class="p-4 bg-gray-50 rounded-lg shadow-sm hover:bg-gray-100 transition flex justify-between items-center"
          >
            <div class="flex items-center space-x-2">
              <span class="font-semibold text-gray-700">{{ mod.order }}.</span>
              <span class="text-gray-800 font-medium">{{ mod.title }}</span>
            </div>

            <!-- 3-dot menu -->
            <div class="relative">
              <button
                type="button"
                (click)="toggleMenu(mod.id)"
                class="p-2 text-gray-500 hover:text-gray-800 rounded-full hover:bg-gray-200 transition"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="h-5 w-5"
                  viewBox="0 0 20 20"
                  fill="currentColor"
                >
                  <path
                    d="M10 3a1.5 1.5 0 110 3 1.5 1.5 0 010-3zm0 5.5a1.5 1.5 0 110 3 1.5 1.5 0 010-3zm0 5.5a1.5 1.5 0 110 3 1.5 1.5 0 010-3z"
                  />
                </svg>
              </button>

              <div
                *ngIf="openMenuId === mod.id"
                class="absolute right-0 mt-2 w-48 bg-white border border-gray-200 rounded-lg shadow-lg z-20"
              >
                <button
                  (click)="viewContents(mod.id)"
                  class="block w-full text-left px-4 py-2 text-gray-700 hover:bg-blue-50 hover:text-blue-700"
                >
                  View Contents
                </button>
                <button
                  (click)="editModule(mod.id)"
                  class="block w-full text-left px-4 py-2 text-gray-700 hover:bg-blue-50 hover:text-blue-700"
                >
                  Edit Module
                </button>
                <button
                  (click)="deleteModule(mod.id)"
                  class="block w-full text-left px-4 py-2 text-red-600 hover:bg-red-50"
                >
                  Delete Module
                </button>
              </div>
            </div>
          </li>
        }
      </ul>
    } @else {
      <div
        class="flex flex-col items-center justify-center p-6 mb-4 bg-gray-50 rounded-lg border border-dashed border-gray-300 text-center"
      >
        <svg
          class="w-12 h-12 text-gray-400 mb-3"
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M9 13h6m2 0a2 2 0 002-2V7a2 2 0 00-2-2h-1V3H8v2H7a2 2 0 00-2 2v4a2 2 0 002 2h2m0 0v6m6-6v6"
          />
        </svg>
        <p class="text-gray-600 font-medium">No modules found</p>
        <p class="text-sm text-gray-500">
          Start by adding your first module below.
        </p>
      </div>
    }
  }

  <!-- Actions -->
  <div class="flex justify-between mt-6 pt-4 border-t">
    <a
      routerLink="/courses"
      class="px-4 py-2 bg-gray-600 text-white rounded-lg shadow hover:bg-gray-700 transition"
    >
      ‚Üê All Courses
    </a>
    <button
      (click)="goToCreate()"
      class="px-4 py-2 bg-blue-600 text-white rounded-lg shadow hover:bg-blue-700 transition"
    >
      + Add Module
    </button>
  </div>
</section>
